openapi: 3.0.3
info:
  title: LexAI API
  description: |
    API for LexAI - AI Legal Assistant
    
    ## Overview
    
    LexAI is an intelligent legal assistant that helps users create and manage legal contracts through conversational AI. The API enables seamless interaction between the frontend application and the AI backend, allowing users to create contracts, have conversations with the AI assistant, and receive real-time contract updates.
    
    ## Key Features
    
    - **Chat Management**: Create and manage multiple contract conversations
    - **AI-Powered Conversations**: Interact with AI assistant to refine contract details
    - **Real-time Contract Updates**: Contract automatically updates with each AI response
    - **Multiple Contract Types**: Support for various contract types (employment, lease, service, etc.)
    
    ## ⚠️ Critical Requirement
    
    **The contract MUST be updated with every assistant response!**
    
    Every time the assistant responds to a user message, the contract must be updated based on the conversation context. This means that if a user provides information (e.g., employee name), that information MUST be included in the updated contract version.
    
    ### Contract Update Requirements:
    
    1. AI/LLM must analyze the conversation context
    2. Extract information from user messages
    3. Update the contract based on this information
    4. Return the updated version in every response
    
    ### Contract Format:
    
    - Contract must always be in **Markdown format**
    - Frontend uses `marked` library for rendering
    - Frontend uses `DOMPurify` for sanitization
    
    ## Data Format
    
    - All requests and responses use `application/json`
    - Dates in ISO 8601 format (e.g., `2025-01-15T10:30:00.000Z`)
    - Contract always in **Markdown format**
  version: 1.0.0
  contact:
    name: LexAI Development Team
    email: dev@lexai.example.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: https://api.lexai.example.com/api
    description: Production server
  - url: http://localhost:3000/api
    description: Development server

tags:
  - name: Chats
    description: Chat management operations for creating and managing contract conversations
  - name: Messages
    description: Send and receive messages within chat conversations

paths:
  /chats:
    get:
      tags:
        - Chats
      summary: Get all chats
      description: |
        Returns a list of all chats for the current user. Each chat represents a contract conversation.
        
        The response includes basic chat information including the latest message and current contract state.
      operationId: getChats
      responses:
        '200':
          description: Successfully retrieved list of chats
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChatsListResponse'
              examples:
                example:
                  summary: Example chat list
                  value:
                    chats:
                      - id: "1"
                        title: "Employment Contract - ABC Corp"
                        lastMessage: "Please provide the employee name and position."
                        timestamp: "2025-01-15T10:30:00.000Z"
                        contract: "# Employment Contract\n\n## 1. Introduction\n\n..."
        '500':
          $ref: '#/components/responses/InternalServerError'

    post:
      tags:
        - Chats
      summary: Create a new chat
      description: |
        Creates a new chat with the specified contract type.
        
        When a chat is created:
        - An initial contract template is generated in Markdown format
        - A welcome message from the assistant is automatically created
        - The chat is ready for user interaction
        
        The contract type determines the template and structure of the contract that will be generated.
      operationId: createChat
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateChatRequest'
            examples:
              employment:
                summary: Create employment contract
                value:
                  contractTypeId: "employment"
                  contractTypeName: "Employment Contract"
              lease:
                summary: Create lease agreement
                value:
                  contractTypeId: "lease"
                  contractTypeName: "Lease Agreement"
              service:
                summary: Create service contract
                value:
                  contractTypeId: "service"
                  contractTypeName: "Service Contract"
      responses:
        '201':
          description: Chat successfully created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChatWithMessages'
              examples:
                example:
                  summary: Newly created chat
                  value:
                    id: "1234567890"
                    title: "Employment Contract"
                    lastMessage: "Creating contract type: Employment Contract. Preparing contract draft and next steps. Please provide details."
                    timestamp: "2025-01-15T10:30:00.000Z"
                    messages:
                      - id: "1"
                        role: "assistant"
                        content: "Creating contract type: Employment Contract. Preparing contract draft and next steps. Please provide details."
                    contract: |
                      # Employment Contract
                      
                      ## 1. Introduction
                      
                      This employment contract is entered into between:
                      
                      **Employer:** [To be filled]
                      
                      **Employee:** [To be filled]
                      
                      **Position:** [To be filled]
                      
                      ## 2. Terms and Conditions
                      
                      ...
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /chats/{chatId}:
    get:
      tags:
        - Chats
      summary: Get chat by ID
      description: |
        Retrieves detailed information about a specific chat by its ID.
        
        Returns the chat metadata including title, last message, timestamp, and current contract state.
      operationId: getChatById
      parameters:
        - name: chatId
          in: path
          required: true
          description: Unique identifier of the chat
          schema:
            type: string
            example: "1234567890"
      responses:
        '200':
          description: Chat found and returned
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Chat'
              examples:
                example:
                  summary: Chat information
                  value:
                    id: "1"
                    title: "Employment Contract - ABC Corp"
                    lastMessage: "Please provide the employee name and position."
                    timestamp: "2025-01-15T10:30:00.000Z"
                    contract: "# Employment Contract\n\n## 1. Introduction\n\n..."
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /chats/{chatId}/messages:
    get:
      tags:
        - Messages
      summary: Get chat messages
      description: |
        Retrieves all messages for a specific chat conversation.
        
        Messages are returned in chronological order, showing the complete conversation history between the user and the AI assistant.
      operationId: getChatMessages
      parameters:
        - name: chatId
          in: path
          required: true
          description: Unique identifier of the chat
          schema:
            type: string
            example: "1234567890"
      responses:
        '200':
          description: Successfully retrieved messages
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessagesListResponse'
              examples:
                example:
                  summary: Example conversation
                  value:
                    messages:
                      - id: "1"
                        role: "user"
                        content: "Please provide the employee name and position."
                      - id: "2"
                        role: "assistant"
                        content: "I understand. I need information about the employee and their position. Please provide the employee's full name and job title."
                      - id: "3"
                        role: "user"
                        content: "The employee name is John Doe and the position is Software Developer."
                      - id: "4"
                        role: "assistant"
                        content: "Thank you. I've recorded that information. The employee name is John Doe and the position is Software Developer."
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

    post:
      tags:
        - Messages
      summary: Send message to chat
      description: |
        Sends a user message to the chat and returns the assistant's response along with the **updated contract**.
        
        ## ⚠️ CRITICALLY IMPORTANT
        
        **The contract MUST be updated with every assistant response!**
        
        This is the most important requirement of the API. Every time the assistant responds to a user message:
        
        1. The AI/LLM must analyze the entire conversation context
        2. Extract relevant information from user messages
        3. Update the contract template with the extracted information
        4. Return the updated contract in the response
        
        ### Example Flow:
        
        **User sends:** "The employee name is John Doe and position is Software Developer"
        
        **System should:**
        - Process the message
        - Extract: name = "John Doe", position = "Software Developer"
        - Update contract: Replace `[To be filled]` placeholders with actual values
        - Return updated contract with John Doe and Software Developer filled in
        
        ### Contract Format Requirements:
        
        - Contract must be in **Markdown format**
        - Must be valid Markdown (frontend uses `marked` for rendering)
        - Should be sanitized (frontend uses `DOMPurify`)
        - Contract should reflect all information gathered so far in the conversation
        
        ### Response Structure:
        
        The response contains two critical pieces:
        1. **message**: The assistant's conversational response
        2. **contract**: The updated contract with all current information incorporated
      operationId: sendMessage
      parameters:
        - name: chatId
          in: path
          required: true
          description: Unique identifier of the chat
          schema:
            type: string
            example: "1234567890"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SendMessageRequest'
            examples:
              example1:
                summary: Initial question
                value:
                  content: "Please provide the employee name and position."
              example2:
                summary: Providing information
                value:
                  content: "The employee name is John Doe and the position is Software Developer"
              example3:
                summary: Additional details
                value:
                  content: "The start date is January 1, 2025 and the salary is $80,000 per year"
      responses:
        '200':
          description: |
            Message successfully sent. Returns the assistant's response and the updated contract.
            
            **Note:** The contract in the response is the updated version that includes all information from the conversation, including the message just sent.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SendMessageResponse'
              examples:
                example1:
                  summary: Initial response (contract with placeholders)
                  value:
                    message:
                      id: "123"
                      role: "assistant"
                      content: "I understand. I need information about the employee and their position. Please provide the employee's full name and job title."
                    contract: |
                      # Employment Contract
                      
                      ## 1. Introduction
                      
                      This employment contract is entered into between:
                      
                      **Employer:** [To be filled]
                      
                      **Employee:** [To be filled]
                      
                      **Position:** [To be filled]
                      
                      ## 2. Terms and Conditions
                      
                      ...
                example2:
                  summary: Response after receiving information
                  value:
                    message:
                      id: "124"
                      role: "assistant"
                      content: "Thank you. I've recorded that information. The employee name is John Doe and the position is Software Developer. Would you like to provide any additional details?"
                    contract: |
                      # Employment Contract
                      
                      ## 1. Introduction
                      
                      This employment contract is entered into between:
                      
                      **Employer:** [To be filled]
                      
                      **Employee:** John Doe
                      
                      **Position:** Software Developer
                      
                      ## 2. Terms and Conditions
                      
                      ...
                example3:
                  summary: Contract with more details filled
                  value:
                    message:
                      id: "125"
                      role: "assistant"
                      content: "Perfect! I've updated the contract with the start date and salary information. The contract now includes: Start Date: January 1, 2025, Salary: $80,000 per year."
                    contract: |
                      # Employment Contract
                      
                      ## 1. Introduction
                      
                      This employment contract is entered into between:
                      
                      **Employer:** [To be filled]
                      
                      **Employee:** John Doe
                      
                      **Position:** Software Developer
                      
                      ## 2. Terms and Conditions
                      
                      ### 2.1 Start Date
                      
                      The employment shall commence on **January 1, 2025**.
                      
                      ### 2.2 Compensation
                      
                      The employee shall receive a salary of **$80,000 per year**, payable in accordance with the company's standard payroll schedule.
                      
                      ...
        '400':
          description: Bad request - invalid or missing message content
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                emptyContent:
                  summary: Empty message content
                  value:
                    error: "Message content is required"
                invalidFormat:
                  summary: Invalid request format
                  value:
                    error: "Invalid request format"
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

components:
  schemas:
    Chat:
      type: object
      description: |
        Chat information containing metadata about a contract conversation.
        
        A chat represents a single contract creation session where the user interacts with the AI assistant to build a contract.
      required:
        - id
        - title
        - lastMessage
        - timestamp
        - contract
      properties:
        id:
          type: string
          description: Unique identifier for the chat
          example: "1234567890"
        title:
          type: string
          description: Chat title, typically the contract type name
          example: "Employment Contract - ABC Corp"
        lastMessage:
          type: string
          description: Text content of the most recent message in the conversation
          example: "Please provide the employee name and position."
        timestamp:
          type: string
          format: date-time
          description: ISO 8601 timestamp of the last update to the chat
          example: "2025-01-15T10:30:00.000Z"
        contract:
          type: string
          description: |
            Current state of the contract in Markdown format.
            
            This contract reflects all information gathered during the conversation so far.
          example: |
            # Employment Contract
            
            ## 1. Introduction
            
            This employment contract is entered into between:
            
            **Employer:** ABC Corp
            
            **Employee:** John Doe
            
            **Position:** Software Developer
            
            ...

    Message:
      type: object
      description: |
        A single message in a chat conversation.
        
        Messages can be from either the user or the assistant.
      required:
        - id
        - role
        - content
      properties:
        id:
          type: string
          description: Unique identifier for the message
          example: "123"
        role:
          type: string
          enum:
            - user
            - assistant
          description: |
            Role of the message sender:
            - `user`: Message from the user
            - `assistant`: Message from the AI assistant
          example: "assistant"
        content:
          type: string
          description: Text content of the message
          example: "I understand. I need information about the employee and their position."

    ChatWithMessages:
      allOf:
        - $ref: '#/components/schemas/Chat'
        - type: object
          required:
            - messages
          description: Chat object that includes the full message history
          properties:
            messages:
              type: array
              description: Array of all messages in the chat conversation
              items:
                $ref: '#/components/schemas/Message'

    ChatsListResponse:
      type: object
      description: Response containing a list of chats
      required:
        - chats
      properties:
        chats:
          type: array
          description: List of chat objects
          items:
            $ref: '#/components/schemas/Chat'

    MessagesListResponse:
      type: object
      description: Response containing a list of messages
      required:
        - messages
      properties:
        messages:
          type: array
          description: List of message objects in chronological order
          items:
            $ref: '#/components/schemas/Message'

    CreateChatRequest:
      type: object
      description: Request payload for creating a new chat
      required:
        - contractTypeId
        - contractTypeName
      properties:
        contractTypeId:
          type: string
          enum:
            - employment
            - lease
            - service
            - partnership
            - purchase
            - other
          description: |
            Contract type identifier:
            - `employment` - Employment Contract
            - `lease` - Lease Agreement
            - `service` - Service Contract / Work Agreement
            - `partnership` - Partnership Agreement / Company Formation
            - `purchase` - Purchase Agreement
            - `other` - Other contract type
          example: "employment"
        contractTypeName:
          type: string
          description: Human-readable name of the contract type
          example: "Employment Contract"

    SendMessageRequest:
      type: object
      description: Request payload for sending a message to a chat
      required:
        - content
      properties:
        content:
          type: string
          description: Text content of the user's message
          minLength: 1
          example: "Please provide the employee name and position."

    SendMessageResponse:
      type: object
      description: |
        Response to a sent message containing the assistant's reply and the updated contract.
        
        **Critical:** The contract in this response is the updated version that includes all information from the conversation, including the message just sent by the user.
      required:
        - message
        - contract
      properties:
        message:
          $ref: '#/components/schemas/Message'
          description: The assistant's response message
        contract:
          type: string
          description: |
            **Updated contract in Markdown format**
            
            ⚠️ **CRITICAL:** This contract MUST be updated based on the entire conversation context, including the user message just sent.
            
            The contract should reflect all information gathered so far:
            - Replace placeholders with actual values provided by the user
            - Add new sections if new information was provided
            - Maintain valid Markdown format
            - Be ready for frontend rendering with `marked` library
          example: |
            # Employment Contract
            
            ## 1. Introduction
            
            This employment contract is entered into between:
            
            **Employer:** ABC Corp
            
            **Employee:** John Doe
            
            **Position:** Software Developer
            
            ## 2. Terms and Conditions
            
            ### 2.1 Start Date
            
            The employment shall commence on **January 1, 2025**.
            
            ### 2.2 Compensation
            
            The employee shall receive a salary of **$80,000 per year**.
            
            ...

    ErrorResponse:
      type: object
      description: Standard error response format
      required:
        - error
      properties:
        error:
          type: string
          description: Human-readable error message
          example: "Chat not found"

  responses:
    BadRequest:
      description: Bad request - invalid or malformed request data
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            error: "Invalid request data"

    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          examples:
            chatNotFound:
              summary: Chat not found
              value:
                error: "Chat not found"
            messageNotFound:
              summary: Message not found
              value:
                error: "Message not found"

    InternalServerError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            error: "Internal server error"
